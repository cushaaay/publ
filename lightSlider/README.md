# Как работает lightSlider()

Этот текст про плагин [lightSlider](http://sachinchoolur.github.io/lightslider/) для `jQuery`. Сам код плагина очень грязный на мой взгляд и в нем много функций, которые я не хочу рассматривать. Поэтому я переписал код по-своему, избавился от `jQuery` и лишних вещей. Но механику работу плагина сохранил.

[**Демо**](https://cushaaay.ru/publ/lightslider/index.html)

## Общий принцип работы плагина

По умолчанию плагин создает карусель, в которой сразу видим три слайда и отступ между ними. А прокрутка происходит по одному слайду влево или вправо.

Я хочу понять только одно - как он сдвигает слайды влево и вправо, какие рассчеты он для этого делает.

Когда скрипт начинает работу он считывает ширину блока, в котором наша карусель находится. Это понадобится для вычисления ширины одного слайда. То есть мы берем эту ширину блока и делим ее на количество слайдов, которые мы хотим показать на первом экране. Потом подсчитываем сколько всего вообще слайдов у нас есть и высчитываем ширину блока, в котором эти слайды лежат. Для этого умножаем количество слайдов на ширину одного слайда. Это нужно, чтобы выстроить все слайды в один ряд. Ширина этого блока будет шире чем ширина блока, в котором лежит весь слайдер. Поэтому нужна обертка, которая обрежет лишнее. Остается только написать скрипт, который будет высчитывать на сколько пикселей сдвигать этот большой блок, когда двигаем влево или вправо.
Нам понадобится переменная, в которой будет лежать курсор, который будет указывать на сколько пикселей влево сдвинут наш блок со слайдами. В нем буду значения кратные ширине одного слайда. Когда мы нажимаем кнопку влево или вправо просто добавляем или вычитаем из курсора ширину слайда и координату этого курсора устанаилваем для блока со слайдами. Плавность делаем с помощью css. И остается только крайние случаи обработать. То есть если в курсоре значение 0, то значит мы сдвинули всю каресель в самое начало, никаких действий делать не нужно. Если мы сдвинули блок со слайдами так сильно вправо, что курсор стал превышать ширину той части блока со слайдами, что скрывалась изначально справа, то значит двигать дальше тоже не надо, мы уперлись в правый край.

## Пишем свою реализацию по этому описанию
Начальная структура `html`:
```html
<div class="carousel">
  <div class="carousel__move">
    <div class="carousel__item">1</div>
    <div class="carousel__item">2</div>
    <div class="carousel__item">3</div>
    <div class="carousel__item">4</div>
    <div class="carousel__item">5</div>
    <div class="carousel__item">6</div>
    <div class="carousel__item">7</div>
  </div>
  <div class="carousel__controls">
    <button class="carousel__button carousel__prev">prev</button>
    <button class="carousel__button carousel__next">next</button>
  </div>
</div>
```
В первую очередь записываем ширину блока `.carousel` в переменную `elWidth`. Дальше с помощью функции `getSlideWidth()` вычисляем ширину одного слайда и записываем ее в переменную `slideWidth`. Теперь нужно высчитать ширину блока, в котором лежат все слайды, чтобы они все в один ряд встали. Делаем это с помощью функции `getContainerWidth()`. Теперь есть все размеры, поэтому с помощью функции `initialStyle()` добавляем все в разметку. Наш блок со всеми слайдами `.carousel__move` теперь очень большой ширины, выходит за пределы экрана, поэтому чтобы его обрезать у его родителя `.carousel` добавляем в `css` свойство `overflow: hidden`. Сама карусель готова, осталось сделать перемещение.
С помощью функции `controls()` навешиваем на кнопки события, во время которых мы либо прибавляем, либо отнимаем значение в переменной `scene`. Сцена - это количество слайдов которые мы сдвинули за пределы экрана влево. У нас есть две переменные: `scene` это количество сдвинутых слайдов, а есть `shift` это ширина всех этих сдвинутых слайдов. Так как наш плагин привязан к левой границе, то мы считаем сколько слайдов ушло за левую часть экрана. В каждом событии кнопки мы всегда проверяем стоит ли еще добавлять или убирать новые сцены. Потому что если мы дошли до границ, то сдвига быть не должно. Когда мы двигаемся к началу карусели, к первым слайдам, то мы все уменьшаем и уменьшаем количество сцен. Если за пределами экрана слева не остается уже ни одного слайда мы перестаем уменьшать количество сцен и просто ничего не делаем. Тогда карусель всегда остановится на первом слайде. С правой стороной иначе. Мы берем ширину всего элемента со всеми слайдами `.carousel__move` и вычитаем из нее ширину одного экрана. То есть мы узнаем какая ширина той части карусели, что скрывается за пределами экрана. Вот когда наша карусель прокрутилась на эту ширину, то значит на экране остается ровно такая ширина карусели, что занимает один экран. Дальше двигаться не надо. После каждого нажатия кнопки мы запускаем функцию `slide()`, которая в `html` добавляет ширину сдвига `shift` для блока со всеми слайдами `.carousel__move`.

Это все. Единственное, что я еще добавил, это функция `resize()` чтобы вычисление ширины происходило на любой ширине экрана как бы мы ее не меняли.